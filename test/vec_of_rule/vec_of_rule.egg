(include "base.egg")

;;;; comb dialect ;;;;
(function comb_concat (Op OpVec Type) Op)

;;;; hw dialect ;;;;
(function hw_output (Op OpVec) Op)

;;;; RootNode for extraction ;;;;
(datatype Root
  (RootNode Op)
)

;; OPS HERE ;;

;; RULES HERE ;;
(ruleset rules)

; NOTE: This rule creates equivalent swapped and original concat operations.
; Both have equal cost, so the extractor may choose either one arbitrarily.
; For testing purposes, use vec_of_rule_extracted_fixed.txt which manually
; specifies the swapped version to demonstrate that reconstruction works.
(rule
  ((= ?lhs (comb_concat ?head ?ops ?t))
   (= ?a (vec-get ?ops 0))
   (= ?b (vec-get ?ops 1)))
  ((union ?lhs (comb_concat ?head (vec-push (vec-push (vec-empty) ?b) ?a) ?t)))
  :ruleset rules
)

(run-schedule (saturate rules))

;; EXTRACTS HERE ;;

