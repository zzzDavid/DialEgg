(include "../../../src/base.egg") ; The tests are run from "build/test/stablehlo"

;;;; StableHLO Dialect ;;;;
(function stablehlo_add (Op Op Type) Op)

; Only supports concat of 2 inputs
(function stablehlo_concatenate (Op Op AttrPair Type) Op :cost 100)

;; OPS HERE ;;

;; RULES HERE ;;
(ruleset rules)
(rule ((= ?A (Value ?id ?t))) ((set (type-of ?A) ?t)) :ruleset rules)

(rewrite ; concat(a, b) + concat(c, d) = concat(a + c, b + d)
  (stablehlo_add (stablehlo_concatenate ?a ?b ?dim ?t) (stablehlo_concatenate ?c ?d ?dim ?t) ?t)
  (stablehlo_concatenate (stablehlo_add ?a ?c (type-of ?a)) (stablehlo_add ?b ?d (type-of ?b)) ?dim ?t)
  :ruleset rules)

(run-schedule (saturate rules))

;; EXTRACTS HERE ;;
