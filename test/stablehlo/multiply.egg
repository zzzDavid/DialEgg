(include "../../../src/base.egg") ; The tests are run from "build/test/stablehlo"

;;;; StableHLO Dialect ;;;;
(function stablehlo_multiply (Op Op Type) Op)
(function stablehlo_add (Op Op Type) Op)
(function stablehlo_constant (AttrPair Type) Op)

;; OPS HERE ;;

;; RULES HERE ;;
(ruleset rules)

(let c2f (stablehlo_constant
  (NamedAttr "value"
             (DenseFPElementsAttr (vec-of 2.0 2.0 2.0 2.0) (RankedTensor (vec-of 4) (F64))))
  (RankedTensor (vec-of 4) (F64))))

(rewrite ; x * 2 = x + x
  (stablehlo_multiply ?x c2f ?a)
  (stablehlo_add ?x ?x ?a)
  :ruleset rules)

(rewrite ; a * (b + c) = a * b + a * c
  (stablehlo_multiply ?a (stablehlo_add ?b ?c ?t) ?t)
  (stablehlo_add (stablehlo_multiply ?a ?b ?t) (stablehlo_multiply ?a ?c ?t) ?t)
  :ruleset rules)

(run-schedule (saturate rules))

;; EXTRACTS HERE ;;
